/*!  2015-01-26 */
(function(){var a,b,c,d,e,f,g,h;window.myblogApp=angular.module("myblog",["ngRoute","ngAnimate"]),myblogApp.config(function(a){var b;return b='<div class="main-bar"><div apr-animate ng-repeat="post in blogList | blogListType : type" class="md"><div class="date"><p class="month">{{post.date.month}}月</p><p class="day">{{post.date.day}}</p></div><div class="md-context"><h1>{{post.title}}</h1><div class="shot-text"><p>{{post.disc}}</p></div></div><div class="md-foot"><a ng-click="scroll2Top()" ng-href="#/post/{{post.url}}"><button class="pull-right btn btn-danger">阅读全文</button></a></div></div></div>',a.when("/",{template:b}).when("/type/:type",{template:b}).when("/post/:name",{templateUrl:"partials/page.html"}).otherwise({redirectTo:"/"})}),myblogApp.filter("blogListType",function(){var a;return a=function(a,b){var c,d,e,f,g;if(e=b.type){for(d={},f=0,g=a.length;g>f;f++)c=a[f],c.type===e&&(d[f]=c);return d}return a}}),myblogApp.directive("markdown",function(){return{restrict:"EA",scope:{content:"=markdownContent"},link:function(a,b){return console.log("xxx"),a.$watch(function(){return a.content},function(a){return b.html(marked(a?a:"#loading...")),b.find("pre>code").each(function(a,b){return hljs.highlightBlock(b)})})}}}),myblogApp.directive("markdownlist",function(){return{restrict:"EA",link:function(a,b){return b.html(marked(b.text()))}}}),myblogApp.directive("aprAnimate",function(){return{restrict:"EA",link:function(a,b){return $(window).scroll(function(){var a,c,d;return a=$(window).height(),d=$(window).scrollTop(),c=b.offset().top,a>=c-d?b.addClass("upsidedown"):void 0})}}}),myblogApp.directive("lazyload",function(){return{restrict:"EA",link:function(a,b,c){var d;return console.log(c),$(window).width()>768?(d=new Image,d.src="images/bk.jpg",d.onload=function(){return $(".mylm").one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){return $(this).addClass("an-updown")}),b.attr("src",c.lazyload)}):void 0}}}),myblogApp.directive("cover",function(){return{restrict:"EA",link:function(a,b){var c;return c=function(){var a,c,d,e;return c=b.width(),e=$(window).width(),a=b.height(),d=$(window).height(),b.css("min-width",d*c/a+"px"),d===a?b.css("left","-"+(c-e)/2+"px"):void 0},c(),window.onresize=function(){return c()}}}}),myblogApp.directive("tracker",function(){return{restrict:"EA",link:function(a,b){return b.mouseleave(function(){var a,c;return a=b.find(".active"),c=a.length>0?a.position().top:0,$(".float-light").css({top:c})}),b.on("mouseenter","li",function(){var a;return a=$(this).position().top,$(".float-light").css({top:a})})}}}),e=function(a){var b,c,d,e,f,g,h,i;for(d={title:"",type:"",tag:"",disc:"",url:"",hide:""},h=a.split("\n"),f=0,g=h.length;g>f;f++)c=h[f],i=c.split(":"),b=i[0],e=i[1],b=_.str.trim(b),e=_.str.trim(e),d.hasOwnProperty(b)&&(d[b]=e);return d.date=d.url.split("-"),d.date.month=parseInt(d.date[1],10),d.date.day=parseInt(d.date[2],10),d},c=function(a){return _.map(a.split(/\n[\-=]+/),e)},d=function(a){var b,c,d,f,g,h,i,j;for(b=!1,c="",g="",j=a.split("\n"),h=0,i=j.length;i>h;h++)d=j[h],/[\-=]+/.test(d)&&(b=!0),b?g+="\n"+d:c+="\n"+d+"\n";return f=e(c),f.text=g,"true"!==f.hide?f:void 0},g=function(a,b,c){var e;return a.name=c.name,b.get("post/"+a.name).success(function(b){return a.post=d(b),e(".blog-container")}),e=function(b){var c;return c=document.createElement("div"),c.setAttribute("id",a.name),c.setAttribute("data-thread-key",a.post.title),c.setAttribute("data-url",a.name),DUOSHUO.EmbedThread(c),jQuery(b).append(c)}},f=["$scope","$http","$routeParams",g],b=function(a,b,d){return a.type=d,window.w=a,b.get("post/list.md").success(function(b){return console.log("indexCtrl"),a.blogList=_.filter(c(b),function(a){return"true"!==a.hide}),a.listType=_.uniq(_.pluck(a.blogList,"type"))}),h(angular.element),a.scroll2Top=function(a){return $(".silder-list li").removeClass("active"),$(a).addClass("active"),window.scrollTo(0,1.4*$(window).height()),setTimeout(function(){return $(window).trigger("scroll")},500)},a.showQQ=function(a){return $(a).html("610164407").wrap('<a href="tencent://message/?uin=610164407&Menu=yes"></a>')},$("#fix-height").css("min-height",$(window).height())},a=["$scope","$http","$routeParams",b],myblogApp.controller("postCtrl",f),myblogApp.controller("indexCtrl",a),h=function(){var a,b,c,d;return a=$("#bk-video")[0],$.stellar(),b=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;return d=$(window),e=$(".head-container"),m=$(".left-bar").offset().top,b=$(".foot-bar"),c=$(".left-bar"),k=0,i=0,j=1,p=function(a){return a.removeClass("mylm-in").addClass("mylm-top"),$(".mylm-arr").fadeIn(500)},o=function(a){return a.removeClass("mylm-top"),$(".mylm-arr").fadeOut(100)},f=function(){var a;return a=c.width(),c.addClass("fixTop"),c.width(a),i=!i},q=function(){return c.removeClass("fixTop"),i=!i},l=function(){return j=!j,a.pause()},n=function(){return j=!j,a.play()},g=function(){return k=!k,$(".f-nav").removeClass("f-nav-bg"),p($(".mylm")),e.css({"-webkit-transform":"scale(0)",transform:"scale(0)"})},h=function(){return k=!k,$(".f-nav").addClass("f-nav-bg"),e.css({"-webkit-transform":"scale(1)",transform:"scale(1)"}),setTimeout(function(){return o($(".mylm"))},100)},function(){var d,e,o,p;return d=$(window).scrollTop(),o=c.offset().top,p=c.height(),e=b.offset().top,$(window).width()>=768&&(d+50>=o&&e-d>=p&&!i&&f(),(m>d+50||p>e-d-50)&&i&&q()),a&&(d>=$(window).height()&&j&&l(),d<$(window).height()&&!j&&n()),d>=80&&!k&&g(),80>d&&k?h():void 0}},d=new b,function(){var a;return a=0,$(window).scroll(function(){return a?void 0:a=setTimeout(function(){return d(),a=0},0)}).scroll()}(),c=function(){var a;return $(window).scrollTop()<=0?clearTimeout(a):(window.scrollBy(0,-100),a=setTimeout(c,10))},$(".mylm").click(function(){return c()})}}).call(this);